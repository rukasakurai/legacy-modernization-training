# TDDラボ

このラボでは、テスト駆動開発（TDD）のRed→Green→Refactorの流れを体験します。キャラクタリゼーションテストで固定した振る舞いを守りつつ、モダンな実装へのリファクタリングや同等性検証、回帰検出までを含みます。

---

## 学習目標
- TDDのRed→Green→Refactorサイクルを体験できる
- テスト先行で新実装を開発できる
- 旧実装と新実装の同等性をテストで検証できる
- 回帰（意図しない変更）をテスト失敗から特定・分析できる

---

## 事前準備
1. **Windows + VS Code** を使用（本トレーニング標準環境）
2. **GitHub Copilot Agent Mode** を有効化
3. **JDK 21** がインストール済みであること
4. （任意）Maven プロジェクトとして進めたい場合は `mvn -v` で動作確認
5. VS Code で本ファイルを開き、ラボ手順に従う

---

## ラボ1 — TDD (Red) フェーズ：新実装のテスト先行
### 目的
TDD の Red を明示的に体験し、「テストが存在しないコードを書かない」姿勢を強化する。
### 作業
1. まだ存在しない `ModernSumCalculator` を使うテストを先に書く（コンパイルエラー = Red）

## ラボ2 — TDD (Green) フェーズ：最小実装でテストを通す
### 目的
<TODO>

### 作業
最小実装でテストを通す（Green）

### Copilot プロンプト例
```
存在しない ModernSumCalculator に対するテストを書いたので、テストが通る最小のクラス骨格を生成してください。
```

---

## ラボ3 — リファクタリング（Refactor）：モダン実装への書き換え
### 目的
TDD の Refactor として内部実装を Stream API へ置き換えつつ、振る舞いを維持する。
### 作業
`ModernSumCalculator` の本実装を Stream API に差し替え。

### Copilot プロンプト例
```
#file:src/test/java/legacy/ModernSumCalculatorTest.java が成功する実装を #file:src/main/java/legacy/ModernSumCalculator.java にしてください。Java 21の機能をフル活用したモダンな実装にしてください。
```

---

## ラボ7 — 回帰検出体験
### 目的
テストが“守っている”ことを実感する。
### 作業
1. `ModernSumCalculator` を意図的に壊す（例：最後の要素を加算しない）
2. テスト失敗を確認し、どのケースが検出したか分析
3. Copilotに失敗原因を説明させる

### 例：誤った変更
```java
// 誤った例（最後の要素を除外）
public int sum(int[] values) {
	return java.util.stream.IntStream.range(0, Math.max(0, values.length - 1))
		.map(i -> values[i])
		.sum();
}
```
→ ランダムテスト / 固定ケースの不一致で検出可能。

### Copilot プロンプト例
```
テストが失敗しました。原因を説明し、修正案を提示してください。 #file:src/main/java/legacy/ModernSumCalculator.java
```

---

## Optional ラボ — 旧実装と新実装を並行実行して比較

「レガシー」実装に継続的に変更が加わっており、「レガシー」実装の実行コストやリスクが低い場合には、旧実装と新実装を並行実行して比較する手段が取れる可能性もあります。

### 作業
1. 並行比較用テスト `SumEquivalenceTest` を作成
2. 複数配列（固定 + ランダム）で両者の出力一致をアサート

### Copilot プロンプト例
```
旧実装と新実装を比較し、100個のランダム配列で結果が一致することを検証するJUnitテストを書いてください。
```

---

## インストラクター向けノート
> **所要時間目安**
> - 15–20分（参加者のJUnit経験により変動）
>
> **参加者レベル別の工夫**
> - 初心者：Stream API 書き換えまで
> - 経験者：ランダム比較・意図的バグ挿入 + 発展課題
>
> **よくある詰まりポイント**
> - “単純だからテスト不要”と思いがち → 小さい題材で流れを定着させる意義を強調
> - ランダムテストの再現性 → 乱数シード固定 (`new Random(0)`) を推奨
